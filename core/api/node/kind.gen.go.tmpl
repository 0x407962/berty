{{- if eq (lower .File.Name) "api/node/kind.proto"}}// file generated by protoc-gen-gotemplate

package node

import (
  "fmt"
  "encoding/json"
)

  {{- range .File.MessageType}}
    {{- if (contains "Attrs" .Name) }}
      {{- $oo := .Name | trunc (int (sub (len .Name) 5)) }}

      // Get{{ $oo }}Attrs is a typesafe version of GetAttrs
      func (e *NodeEvent) Get{{ $oo }}Attrs() (*{{$oo}}Attrs, error) {
        if e.Attributes == nil || len(e.Attributes) == 0 {
          return &{{$oo}}Attrs{}, nil
        }
        {{- /* e.Attributes = &NodeEvent_{{$oo}}Attrs{{`{`}}{{$oo}}Attrs: &attrs} */}}
        var attrs {{$oo}}Attrs
        return &attrs, json.Unmarshal(e.Attributes, &attrs)
      }

      // Set{{$oo}}Attrs is a typesafe version of the generic SetAttrs method
      func (e *NodeEvent) Set{{$oo}}Attrs(attrs *{{$oo}}Attrs) error {
        raw, err := json.Marshal(attrs)
        if err != nil {
          return err
        }
        e.Attributes = raw
        return nil
      }
    {{- end}}
  {{- end}}

  // GetAttrs parses the embedded attributes
  func (e *NodeEvent) GetAttrs() (interface{}, error) {
    switch e.Kind {
      {{- range .File.MessageType}}
        {{- if (contains "Attrs" .Name) }}
          {{- $oo := .Name | trunc (int (sub (len .Name) 5)) }}
          case Kind_{{$oo}}:
            return e.Get{{$oo}}Attrs()
        {{- end }}
      {{- end }}
    }
    return nil, fmt.Errorf("not supported event kind: %q", e.Kind)
  }

{{- end }}
